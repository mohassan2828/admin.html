<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة تحكم CV محمد</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white p-5">
    <h1 class="text-3xl font-bold text-center mb-10 text-blue-400">إحصائيات موقع الـ CV</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
        <div class="bg-gray-800 p-6 rounded-lg text-center shadow-lg border-b-4 border-blue-500">
            <h2 class="text-xl">إجمالي الزوار</h2>
            <p id="total-visitors" class="text-5xl font-bold mt-2">0</p>
        </div>
        <div class="bg-gray-800 p-6 rounded-lg text-center shadow-lg border-b-4 border-green-500">
            <h2 class="text-xl">إجمالي التحميلات</h2>
            <p id="total-downloads" class="text-5xl font-bold mt-2">0</p>
        </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl mb-4 text-blue-300">آخر الزوار</h2>
        <table class="w-full text-right">
            <thead>
                <tr class="border-b border-gray-700">
                    <th class="p-2">التوقيت</th>
                    <th class="p-2">الدولة</th>
                    <th class="p-2">المدينة</th>
                </tr>
            </thead>
            <tbody id="visitors-table"></tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // نفس بياناتك اللي كانت في الصور
        const firebaseConfig = {
            apiKey: "AIzaSyBeTU1K8LyYh5ZRa9omgewSO9PP4JxFvf4",
            authDomain: "cv-stats-d2eda.firebaseapp.com",
            projectId: "cv-stats-d2eda",
            storageBucket: "cv-stats-d2eda.appspot.com",
            messagingSenderId: "751477887016",
            appId: "1:751477887016:web:315202dbae3a945f02a51d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // مراقبة الزوار (visitor_lo)
        onSnapshot(collection(db, "visitor_lo"), (snapshot) => {
            document.getElementById('total-visitors').innerText = snapshot.size;
            const table = document.getElementById('visitors-table');
            table.innerHTML = "";
            snapshot.docs.slice(0, 5).forEach(doc => {
                const d = doc.data();
                table.innerHTML += `<tr class="border-b border-gray-700 text-sm">
                    <td class="p-2">${d.timestamp?.toDate().toLocaleString('ar-EG') || 'حالية'}</td>
                    <td class="p-2">${d.country || 'غير معروف'}</td>
                    <td class="p-2">${d.city || 'غير معروف'}</td>
                </tr>`;
            });
        });

        // مراقبة التحميلات (download_logs)
        onSnapshot(collection(db, "download_logs"), (snapshot) => {
            document.getElementById('total-downloads').innerText = snapshot.size;
        });
    </script>
</body>
</html>
